user www-data;
worker_processes 1;
pid /run/nginx.pid;

events {
        worker_connections 8000;
        multi_accept on;
}

http {

        ##
        # Basic Settings
        ##

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65s;
        types_hash_max_size 2048;
        # server_tokens off;

        # server_names_hash_bucket_size 64;
        # server_name_in_redirect off;

    fastcgi_buffers 8 16k;
    fastcgi_buffer_size 32k;
    fastcgi_connect_timeout 300;
    fastcgi_send_timeout 300;
    fastcgi_read_timeout 300;
    client_max_body_size 200M;

        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        ##
        # SSL Settings
        ##

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
        ssl_prefer_server_ciphers on;

        ##
        # Logging Settings
        ##

        access_log off;
        error_log /var/log/nginx/error.log;

        ##
        # Gzip Settings
        ##

        gzip on;
    gzip_comp_level 5;
    gzip_http_version 1.1;
    gzip_proxied any;
    gzip_min_length 256;
    gzip_buffers 16 8k;
    # Compress all output labeled with one of the following MIME-types.
    # `text/html` is always compressed by gzip module.
    # Default: text/html
    gzip_types
      application/atom+xml
      application/geo+json
      application/javascript
      application/json
      application/ld+json
      application/manifest+json
      application/rdf+xml
      application/rss+xml
      application/vnd.ms-fontobject
      application/wasm
      application/x-web-app-manifest+json
      application/xhtml+xml
      application/xml
      font/otf
      image/bmp
      image/svg+xml
      text/cache-manifest
      text/calendar
      text/css
      text/javascript
      text/markdown
      text/plain
      text/vcard
      text/vnd.rim.location.xloc
      text/vtt
      text/x-component;

    # Disable for IE < 6 because there are some known problems
    gzip_disable "MSIE [1-6].(?!.*SV1)";

    # Add a vary header for downstream proxies to avoid sending cached gzipped files to IE6
    gzip_vary on;

    gzip_static on;

    map $http_upgrade $connection_upgrade {
        default   upgrade;
        ''        close;
    }

    # Expires map
    map $sent_http_content_type $expires {
        default                    off;
        text/html                  epoch;
        text/css                   max;
        application/javascript     max;
        ~image/                    max;
    }


        ##
        # Virtual Host Configs
        ##

        include /etc/nginx/conf.d/*.conf;
    server {
        listen 80;
        server_name www.niltonpimentel.com.br niltonpimentel.com.br;
        charset utf-8;

        location ^~ /.well-known {
          allow all;
          root  /var/www/certbot;
        }

        location /.well-known/acme-challenge/ {
            root  /var/www/certbot;
        }

        #return 301 https://$host$request_uri;
        location / {
             proxy_redirect     off;
             proxy_pass http://web:8900/;
             proxy_set_header   Host $host;
             proxy_set_header   X-Real-IP $remote_addr;
             proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_set_header   X-Forwarded-Host $server_name;
             proxy_buffering    off;
         }
    }
#     server {
#         listen      443           ssl http2;
#         listen [::]:443           ssl http2;
#         server_name niltonpimentel.com.br;
#         charset     utf-8;
#
#         ssl_certificate           /etc/nginx/ssl/live/app.lojaconectada.com.br/fullchain.pem;
#         ssl_certificate_key       /etc/nginx/ssl/live/app.lojaconectada.com.br/privkey.pem;
#         ssl_trusted_certificate   /etc/nginx/ssl/live/app.lojaconectada.com.br/chain.pem;
#
#         location ~ ^/.well-known {
#             allow all;
#             root /var/www/certbot;
#         }
#
#         location /.well-known/acme-challenge/ {
#             allow all;
#             root /var/www/certbot;
#         }
#
#         # max upload size
#         client_max_body_size 4G;
#
#         # Django media
#         location /media  {
#             alias /opt/app/integrador/media;
#             add_header Cache-Control "public, max-age=259200, s-maxage=259200";
#         }
#
#         location /static {
#             alias /static/integrador;
#             add_header Cache-Control "public, max-age=259200, s-maxage=259200";
#         }
#     }
}
